(()=>{"use strict";var e={d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};e.d({},{M2:()=>u,H6:()=>d,iB:()=>h});let n=!1,t="vertical";const o=(()=>{document.querySelectorAll(".game-panel");const e=document.querySelectorAll(".gameboard"),a=e[0],l=e[1];function c(e){e.textContent=""}return{renderPlayerBoard:function(e){const l=e.gameboard,s=a;c(s);const i=r.buildPlayerBoard(l);l.areAllShipsPlaced()||i.addEventListener("click",(r=>function(e,r){const a=r.gameboard,l=a.sideLength,c=e.target;if(c.classList.contains("board-cell")){const e=c.parentNode.children,s=Array.from(e).indexOf(c),i=Math.floor(s/l),h=s%l;a.setShip({x:h,y:i},t),o.renderPlayerBoard(r),a.areAllShipsPlaced()&&(n=!0,d())}}(r,e)),!0),s.appendChild(i)},renderOpponentBoard:function(e){const t=e.gameboard,o=l;c(o);const a=r.buildOpponentBoard(t);n&&a.addEventListener("click",(e=>h(e)),!0),o.appendChild(a)}}})(),r={buildPlayerBoard:function(e){const n=document.createElement("div");n.classList.add("board-grid");for(let t of e.board)for(let e of t){const t=document.createElement("div");t.classList.add("board-cell"),e.hasShip()&&e.isChecked?t.classList.add("dead-ship-cell"):e.hasShip()?t.classList.add("live-ship-cell"):e.isChecked&&t.classList.add("cell-checked"),n.appendChild(t)}return n},buildOpponentBoard:function(e){const n=document.createElement("div");n.classList.add("board-grid");for(let t of e.board)for(let e of t){const t=document.createElement("div");t.classList.add("board-cell"),e.hasShip()&&e.isChecked?t.classList.add("dead-ship-cell"):e.isChecked&&t.classList.add("cell-checked"),n.appendChild(t)}return n}};document.getElementById("rotate_button").addEventListener("click",(function(){t="horizontal"===t?"vertical":"horizontal"}));const a=o,l=()=>{const e={isChecked:!1,ship:null,shipIndex:null,assignShip(n,t){e.ship=n,e.shipIndex=t},hasShip:()=>null!==e.ship};return e},c=e=>{const n=e,t=function(e){let n=Array(e);for(let t=0;t<e;t++){n[t]=Array(e);for(let o=0;o<e;o++)n[t][o]=l()}return n}(e);let o=[5,4,3,3,2];function r(){return c.ships.map((e=>e.isSunk())).every((e=>!0===e))}function a(e){return c.board[e.y][e.x]}const c={sideLength:n,board:t,ships:[],missed:[],getCell:a,setShip:function(e,t){const r=((e,n,t)=>{const o={length:e,cells:Array(e).fill(!0),pos:n,orie:t,hit:function(e){o.cells[e]=!1},isSunk:function(){return o.cells.every((e=>0==e))}};return o})(o[0],e,t),l=function(e){const t=e.length,o=e.pos,r=e.orie;let l=[];for(let e=0;e<t;e++){let t;"horizontal"===r?o.x+e<n&&(t=a({x:o.x+e,y:o.y})):"vertical"===r&&o.y+e<n&&(t=a({x:o.x,y:o.y+e})),l.push([t,e])}return!!l.every((e=>void 0!==e[0]&&!e[0].hasShip()))&&(l.forEach((n=>{n[0].assignShip(e,n[1])})),!0)}(r);l&&(c.ships.push(r),o.shift())},areAllShipsSunk:r,areAllShipsPlaced:function(){return o.length<=0},scrambleShips:function(){for(;!c.areAllShipsPlaced();){const e=Math.floor(2*Math.random())?"horizontal":"vertical",t=Math.floor(Math.random()*n),o=Math.floor(Math.random()*n);c.setShip({x:t,y:o},e)}},recieveAttack:function(e){const n=a({x:e.x,y:e.y});if(n.hasShip()){const e=n.ship,t=n.shipIndex;e.hit(t),e.isSunk()&&console.log("SHIP SUNK")}else c.missed.push(e);n.isChecked=!0,r()&&u()},wasCellChecked:function(e){return!0===a(e).isChecked}};return c},s=(e,n=!1)=>{function t(e,n){return!e.gameboard.wasCellChecked(n)&&(e.gameboard.recieveAttack(n),!0)}const o={name:e,isAI:n,gameboard:c(10),attackOpponent:t};return n&&(o.attackRandomCell=function(e){const n=e.gameboard.board.length;let o=!1;for(;!o;)o=t(e,{x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*n)})}),o};let i;function d(){const e=i[1];a.renderOpponentBoard(e)}function h(e){const n=i[0],t=i[1],o=n.gameboard.sideLength,r=e.target;if(r.classList.contains("board-cell")){const e=r.parentNode.children,l=Array.from(e).indexOf(r),c=Math.floor(l/o),s=l%o;let d=!1;if(d=n.attackOpponent(t,{x:s,y:c}),!d)return!1;a.renderOpponentBoard(t),function(){const e=i[0];i[1].attackRandomCell(e),a.renderPlayerBoard(e)}()}}function u(){const e=i[0],t=i[1];e.gameboard.areAllShipsSunk()?p(t):p(e),function(e){n=!1,o.renderPlayerBoard(e[0]),o.renderPlayerBoard(e[1])}(i)}function p(e){console.log(`${e.name} wins!`)}!function(){const e=s("Player"),n=s("CPU",!0);i=[e,n],function(){const e=i[1];e.gameboard.scrambleShips(),a.renderOpponentBoard(e)}(),function(){const e=i[0];a.renderPlayerBoard(e)}()}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBUW1HLEdBV3JCLFdBQ0UsTUFBTXBFLEVBQVcrRCxFQUFRLEdBRXpCL0QsRUFBUzlCLFVBQVU4RSxnQkFDbkIsc0JBQTRCaEQsR0FkNUJxRSxHQUlGLFdBQ0UsTUFBTXBHLEVBQVM4RixFQUFRLEdBRXZCLG9CQUEwQjlGLEdBTjFCcUcsR0E0RUZDLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlDb250cm9sbGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZU9iamVjdHMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZU9iamVjdHMvc2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVPYmplY3RzL3BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiaW1wb3J0IHsgZ2FtZSwgZ2FtZVBsYXllclR1cm4gfSBmcm9tIFwiLi9pbmRleC5qc1wiO1xuXG5sZXQgaW5HYW1lbG9vcCA9IGZhbHNlO1xubGV0IHNlbGVjdGVkUm90YXRpb24gPSAndmVydGljYWwnO1xuXG5jb25zdCBkaXNwbGF5Q29udHJvbGxlciA9ICgoKSA9PiB7XG4gIGNvbnN0IGRpc3BsYXlHYW1lUGFuZWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdhbWUtcGFuZWwnKTtcbiAgY29uc3QgZGlzcGxheUdhbWVib2FyZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ2FtZWJvYXJkJyk7XG5cbiAgY29uc3QgcGxheWVyRGlzcGxheUdhbWVib2FyZCA9IGRpc3BsYXlHYW1lYm9hcmRzWzBdO1xuICBjb25zdCBvcHBvbmVudERpc3BsYXlHYW1lYm9hcmQgPSBkaXNwbGF5R2FtZWJvYXJkc1sxXTtcblxuICBmdW5jdGlvbiBjbGVhckRpc3BsYXlCb2FyZChkaXNwbGF5R2FtZWJvYXJkKSB7XG4gICAgZGlzcGxheUdhbWVib2FyZC50ZXh0Q29udGVudCA9ICcnO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVuZGVyUGxheWVyQm9hcmQocGxheWVyKSB7XG4gICAgY29uc3QgZ2FtZWJvYXJkID0gcGxheWVyLmdhbWVib2FyZDtcbiAgICBjb25zdCBkaXNwbGF5R2FtZWJvYXJkID0gcGxheWVyRGlzcGxheUdhbWVib2FyZDtcbiAgICBjbGVhckRpc3BsYXlCb2FyZChkaXNwbGF5R2FtZWJvYXJkKTtcblxuICAgIGNvbnN0IGRpc3BsYXlHcmlkID0gZWxlbWVudEJ1aWxkZXIuYnVpbGRQbGF5ZXJCb2FyZChnYW1lYm9hcmQpO1xuICAgIGlmICghZ2FtZWJvYXJkLmFyZUFsbFNoaXBzUGxhY2VkKCkpIHtcbiAgICAgIGRpc3BsYXlHcmlkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4gYWRkU2hpcChldnQsIHBsYXllciksIHRydWUpO1xuICAgIH1cbiAgICBkaXNwbGF5R2FtZWJvYXJkLmFwcGVuZENoaWxkKGRpc3BsYXlHcmlkKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlck9wcG9uZW50Qm9hcmQob3Bwb25lbnQpIHtcbiAgICBjb25zdCBnYW1lYm9hcmQgPSBvcHBvbmVudC5nYW1lYm9hcmQ7XG4gICAgY29uc3QgZGlzcGxheUdhbWVib2FyZCA9IG9wcG9uZW50RGlzcGxheUdhbWVib2FyZDtcbiAgICBjbGVhckRpc3BsYXlCb2FyZChkaXNwbGF5R2FtZWJvYXJkKTtcblxuICAgIGNvbnN0IGRpc3BsYXlHcmlkID0gZWxlbWVudEJ1aWxkZXIuYnVpbGRPcHBvbmVudEJvYXJkKGdhbWVib2FyZCk7XG4gICAgaWYgKGluR2FtZWxvb3ApIHtcbiAgICAgIGRpc3BsYXlHcmlkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4gZ2FtZVBsYXllclR1cm4oZXZ0KSwgdHJ1ZSk7XG4gICAgfVxuICAgIGRpc3BsYXlHYW1lYm9hcmQuYXBwZW5kQ2hpbGQoZGlzcGxheUdyaWQpO1xuICB9XG5cbiAgY29uc3QgcmV0cyA9IHtcbiAgICByZW5kZXJQbGF5ZXJCb2FyZCxcbiAgICByZW5kZXJPcHBvbmVudEJvYXJkXG4gIH07XG5cbiAgcmV0dXJuIHJldHM7XG59KSgpO1xuXG5jb25zdCBlbGVtZW50QnVpbGRlciA9ICgoKSA9PiB7XG4gIGZ1bmN0aW9uIGJ1aWxkUGxheWVyQm9hcmQoZ2FtZWJvYXJkKSB7XG4gICAgY29uc3QgYm9hcmRHcmlkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgYm9hcmRHcmlkLmNsYXNzTGlzdC5hZGQoJ2JvYXJkLWdyaWQnKTtcblxuICAgIGZvciAobGV0IHJvdyBvZiBnYW1lYm9hcmQuYm9hcmQpIHtcbiAgICAgIGZvciAobGV0IGNlbGwgb2Ygcm93KSB7XG4gICAgICAgIGNvbnN0IGJvYXJkQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBib2FyZENlbGwuY2xhc3NMaXN0LmFkZCgnYm9hcmQtY2VsbCcpO1xuXG4gICAgICAgIGlmIChjZWxsLmhhc1NoaXAoKSAmJiBjZWxsLmlzQ2hlY2tlZCkge1xuICAgICAgICAgIGJvYXJkQ2VsbC5jbGFzc0xpc3QuYWRkKCdkZWFkLXNoaXAtY2VsbCcpO1xuICAgICAgICB9IGVsc2UgaWYgKGNlbGwuaGFzU2hpcCgpKSB7XG4gICAgICAgICAgYm9hcmRDZWxsLmNsYXNzTGlzdC5hZGQoJ2xpdmUtc2hpcC1jZWxsJyk7XG4gICAgICAgIH0gZWxzZSBpZiAoY2VsbC5pc0NoZWNrZWQpIHtcbiAgICAgICAgICBib2FyZENlbGwuY2xhc3NMaXN0LmFkZCgnY2VsbC1jaGVja2VkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBib2FyZEdyaWQuYXBwZW5kQ2hpbGQoYm9hcmRDZWxsKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmRHcmlkO1xuICB9XG5cbiAgZnVuY3Rpb24gYnVpbGRPcHBvbmVudEJvYXJkKGdhbWVib2FyZCkge1xuICAgIGNvbnN0IGJvYXJkR3JpZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGJvYXJkR3JpZC5jbGFzc0xpc3QuYWRkKCdib2FyZC1ncmlkJyk7XG5cbiAgICBmb3IgKGxldCByb3cgb2YgZ2FtZWJvYXJkLmJvYXJkKSB7XG4gICAgICBmb3IgKGxldCBjZWxsIG9mIHJvdykge1xuICAgICAgICBjb25zdCBib2FyZENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgYm9hcmRDZWxsLmNsYXNzTGlzdC5hZGQoJ2JvYXJkLWNlbGwnKTtcblxuICAgICAgICBpZiAoY2VsbC5oYXNTaGlwKCkgJiYgY2VsbC5pc0NoZWNrZWQpIHtcbiAgICAgICAgICBib2FyZENlbGwuY2xhc3NMaXN0LmFkZCgnZGVhZC1zaGlwLWNlbGwnKTtcbiAgICAgICAgfSBlbHNlIGlmIChjZWxsLmlzQ2hlY2tlZCkge1xuICAgICAgICAgIGJvYXJkQ2VsbC5jbGFzc0xpc3QuYWRkKCdjZWxsLWNoZWNrZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJvYXJkR3JpZC5hcHBlbmRDaGlsZChib2FyZENlbGwpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBib2FyZEdyaWQ7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGJ1aWxkUGxheWVyQm9hcmQsXG4gICAgYnVpbGRPcHBvbmVudEJvYXJkXG4gIH07XG59KSgpO1xuXG5cbmZ1bmN0aW9uIGFkZFNoaXAoZXZ0LCBwbGF5ZXIpIHtcbiAgY29uc3QgZ2FtZWJvYXJkID0gcGxheWVyLmdhbWVib2FyZDtcbiAgY29uc3Qgc2l6ZSA9IGdhbWVib2FyZC5zaWRlTGVuZ3RoO1xuXG4gIGNvbnN0IHRhcmdldCA9IGV2dC50YXJnZXQ7XG4gIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdib2FyZC1jZWxsJykpIHtcbiAgICBjb25zdCBncmlkQ2VsbHMgPSB0YXJnZXQucGFyZW50Tm9kZS5jaGlsZHJlbjtcbiAgICBjb25zdCB0YXJnZXRJbmRleCA9ICBBcnJheS5mcm9tKGdyaWRDZWxscykuaW5kZXhPZih0YXJnZXQpO1xuXG4gICAgY29uc3QgdGFyZ2V0Um93ID0gTWF0aC5mbG9vcih0YXJnZXRJbmRleCAvIHNpemUpO1xuICAgIGNvbnN0IHRhcmdldENvbCA9IHRhcmdldEluZGV4ICUgc2l6ZTtcblxuICAgIGdhbWVib2FyZC5zZXRTaGlwKHt4OnRhcmdldENvbCwgeTp0YXJnZXRSb3d9LCBzZWxlY3RlZFJvdGF0aW9uKTtcblxuICAgIGRpc3BsYXlDb250cm9sbGVyLnJlbmRlclBsYXllckJvYXJkKHBsYXllcik7XG5cbiAgICBpZihnYW1lYm9hcmQuYXJlQWxsU2hpcHNQbGFjZWQoKSkge1xuICAgICAgaW5HYW1lbG9vcCA9IHRydWU7XG4gICAgICBnYW1lKCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGRpc2FibGVCb2FyZHMocGxheWVycykge1xuICBpbkdhbWVsb29wID0gZmFsc2U7XG4gIGRpc3BsYXlDb250cm9sbGVyLnJlbmRlclBsYXllckJvYXJkKHBsYXllcnNbMF0pO1xuICBkaXNwbGF5Q29udHJvbGxlci5yZW5kZXJQbGF5ZXJCb2FyZChwbGF5ZXJzWzFdKTtcbn1cblxuXG5mdW5jdGlvbiB0b2dnbGVSb3RhdGlvbigpIHtcbiAgaWYgKHNlbGVjdGVkUm90YXRpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgIHNlbGVjdGVkUm90YXRpb24gPSAndmVydGljYWwnO1xuICB9IGVsc2Uge1xuICAgIHNlbGVjdGVkUm90YXRpb24gPSAnaG9yaXpvbnRhbCc7XG4gIH1cbn1cblxuY29uc3Qgcm90YXRlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JvdGF0ZV9idXR0b24nKTtcbnJvdGF0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZVJvdGF0aW9uKVxuXG5cblxuXG5leHBvcnQgZGVmYXVsdCBkaXNwbGF5Q29udHJvbGxlcjtcbmV4cG9ydCB7IGRpc2FibGVCb2FyZHMgfTsiLCJpbXBvcnQgU2hpcCBmcm9tIFwiLi9zaGlwLmpzXCI7XG5pbXBvcnQgeyBkZXRlcm1pbmVXaW5uZXIgfSBmcm9tIFwiLi4vaW5kZXguanNcIjtcblxuY29uc3QgQ2VsbCA9ICgpID0+IHtcbiAgY29uc3QgcmV0cyA9IHtcbiAgICBpc0NoZWNrZWQ6IGZhbHNlLFxuXG4gICAgc2hpcDogbnVsbCxcbiAgICBzaGlwSW5kZXg6IG51bGwsXG4gICAgYXNzaWduU2hpcChzaGlwLCBpbmRleCkge1xuICAgICAgcmV0cy5zaGlwID0gc2hpcDtcbiAgICAgIHJldHMuc2hpcEluZGV4ID0gaW5kZXg7XG4gICAgfSxcbiAgICBoYXNTaGlwKCkge1xuICAgICAgcmV0dXJuIHJldHMuc2hpcCAhPT0gbnVsbDtcbiAgICB9LFxuICB9O1xuXG4gIHJldHVybiByZXRzO1xufTtcblxuY29uc3QgR2FtZWJvYXJkID0gKHNpemUpID0+IHtcbiAgY29uc3Qgc2lkZUxlbmd0aCA9IHNpemU7XG4gIGNvbnN0IGJvYXJkID0gX2NyZWF0ZUJvYXJkR3JpZChzaXplKTtcbiAgY29uc3Qgc2hpcHMgPSBbXTtcbiAgY29uc3QgbWlzc2VkID0gW107XG5cbiAgbGV0IG5leHRTaGlwTGVuZ3RocyA9IFs1LCA0LCAzLCAzLCAyXTtcblxuICBmdW5jdGlvbiBfY3JlYXRlQm9hcmRHcmlkKHNpemUpIHtcbiAgICBsZXQgZ3JpZCA9IEFycmF5KHNpemUpO1xuICAgIGZvciAobGV0IHIgPSAwOyByIDwgc2l6ZTsgcisrKSB7XG4gICAgICBncmlkW3JdID0gQXJyYXkoc2l6ZSk7XG4gICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHNpemU7IGMrKykge1xuICAgICAgICBncmlkW3JdW2NdID0gQ2VsbCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBncmlkO1xuICB9XG5cbiAgZnVuY3Rpb24gX2Fzc2lnblNoaXBDZWxscyhzaGlwKSB7XG4gICAgY29uc3QgbGVuZ3RoID0gc2hpcC5sZW5ndGg7XG4gICAgY29uc3Qgc3RhcnRQb3MgPSBzaGlwLnBvcztcbiAgICBjb25zdCBvcmllID0gc2hpcC5vcmllO1xuXG4gICAgbGV0IHRvT2NjdXB5Q2VsbHMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBjZWxsID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKG9yaWUgPT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICAgIGlmIChzdGFydFBvcy54ICsgaSA8IHNpZGVMZW5ndGgpIHtcbiAgICAgICAgICBjZWxsID0gZ2V0Q2VsbCh7XG4gICAgICAgICAgICB4OiBzdGFydFBvcy54ICsgaSxcbiAgICAgICAgICAgIHk6IHN0YXJ0UG9zLnksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAob3JpZSA9PT0gXCJ2ZXJ0aWNhbFwiKSB7XG4gICAgICAgIGlmIChzdGFydFBvcy55ICsgaSA8IHNpZGVMZW5ndGgpIHtcbiAgICAgICAgICBjZWxsID0gZ2V0Q2VsbCh7XG4gICAgICAgICAgICB4OiBzdGFydFBvcy54LFxuICAgICAgICAgICAgeTogc3RhcnRQb3MueSArIGksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRvT2NjdXB5Q2VsbHMucHVzaChbY2VsbCwgaV0pO1xuICAgIH1cblxuICAgIGNvbnN0IGFyZUxlZ2FsUGxhY2VtZW50cyA9IHRvT2NjdXB5Q2VsbHMuZXZlcnkoKGNlbGwpID0+IHtcbiAgICAgIGlmIChjZWxsWzBdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKGNlbGxbMF0uaGFzU2hpcCgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuXG4gICAgaWYgKGFyZUxlZ2FsUGxhY2VtZW50cykge1xuICAgICAgdG9PY2N1cHlDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgIGNlbGxbMF0uYXNzaWduU2hpcChzaGlwLCBjZWxsWzFdKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFyZUFsbFNoaXBzU3VuaygpIHtcbiAgICByZXR1cm4gcmV0cy5zaGlwc1xuICAgICAgLm1hcCgoc2hpcCkgPT4ge1xuICAgICAgICByZXR1cm4gc2hpcC5pc1N1bmsoKTtcbiAgICAgIH0pXG4gICAgICAuZXZlcnkoKGJvb2xWYWx1ZSkgPT4ge1xuICAgICAgICByZXR1cm4gYm9vbFZhbHVlID09PSB0cnVlO1xuICAgICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDZWxsKHBvcykge1xuICAgIHJldHVybiByZXRzLmJvYXJkW3Bvcy55XVtwb3MueF07XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGFyZUFsbFNoaXBzUGxhY2VkKCkge1xuICAgIHJldHVybiBuZXh0U2hpcExlbmd0aHMubGVuZ3RoIDw9IDA7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRTaGlwKHBvcywgb3JpZSkge1xuICAgIGNvbnN0IGxlbmd0aCA9IG5leHRTaGlwTGVuZ3Roc1swXTtcbiAgICBjb25zdCBzaGlwID0gU2hpcChsZW5ndGgsIHBvcywgb3JpZSk7XG4gICAgY29uc3QgcmVzdWx0ID0gX2Fzc2lnblNoaXBDZWxscyhzaGlwKTtcbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICByZXRzLnNoaXBzLnB1c2goc2hpcCk7XG4gICAgICBuZXh0U2hpcExlbmd0aHMuc2hpZnQoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzY3JhbWJsZVNoaXBzKCkge1xuICAgIHdoaWxlICghcmV0cy5hcmVBbGxTaGlwc1BsYWNlZCgpKSB7XG4gICAgICBjb25zdCByYW5kT3JpZSA9IChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSkgPyAnaG9yaXpvbnRhbCcgOiAndmVydGljYWwnO1xuICAgICAgY29uc3QgcmFuZFggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaWRlTGVuZ3RoKTtcbiAgICAgIGNvbnN0IHJhbmRZID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc2lkZUxlbmd0aCk7XG5cbiAgICAgIHJldHMuc2V0U2hpcCh7eDogcmFuZFgsIHk6IHJhbmRZfSwgcmFuZE9yaWUpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHJlY2lldmVBdHRhY2socG9zKSB7XG4gICAgY29uc3QgY2VsbCA9IGdldENlbGwoe1xuICAgICAgeDogcG9zLngsXG4gICAgICB5OiBwb3MueSxcbiAgICB9KTtcbiAgICBpZiAoY2VsbC5oYXNTaGlwKCkpIHtcbiAgICAgIGNvbnN0IHNoaXAgPSBjZWxsLnNoaXA7XG4gICAgICBjb25zdCBzaGlwSW5kZXggPSBjZWxsLnNoaXBJbmRleDtcbiAgICAgIHNoaXAuaGl0KHNoaXBJbmRleCk7XG5cbiAgICAgIGlmIChzaGlwLmlzU3VuaygpKSB7XG4gICAgICAgIC8vIFNoaXAgc3Vua2VuIGNvZGUgaGVyZVxuICAgICAgICBjb25zb2xlLmxvZyhcIlNISVAgU1VOS1wiKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0cy5taXNzZWQucHVzaChwb3MpO1xuICAgIH1cbiAgICBjZWxsLmlzQ2hlY2tlZCA9IHRydWU7XG5cbiAgICBpZiAoYXJlQWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgIC8vIEdhbWVvdmVyIGNvZGUvZnVuY3Rpb24gY2FsbCBoZXJlXG4gICAgICBkZXRlcm1pbmVXaW5uZXIoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB3YXNDZWxsQ2hlY2tlZChwb3MpIHtcbiAgICByZXR1cm4gZ2V0Q2VsbChwb3MpLmlzQ2hlY2tlZCA9PT0gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0IHJldHMgPSB7XG4gICAgc2lkZUxlbmd0aCxcbiAgICBib2FyZCxcbiAgICBzaGlwcyxcbiAgICBtaXNzZWQsXG5cbiAgICBnZXRDZWxsLFxuICAgIHNldFNoaXAsXG4gICAgYXJlQWxsU2hpcHNTdW5rLFxuICAgIGFyZUFsbFNoaXBzUGxhY2VkLFxuICAgIHNjcmFtYmxlU2hpcHMsXG4gICAgcmVjaWV2ZUF0dGFjayxcbiAgICB3YXNDZWxsQ2hlY2tlZCxcbiAgfTtcblxuICByZXR1cm4gcmV0cztcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZDtcbiIsImNvbnN0IFNoaXAgPSAobGVuZ3RoLCBwb3MsIG9yaWUpID0+IHtcbiAgY29uc3QgY2VsbHMgPSBBcnJheShsZW5ndGgpLmZpbGwodHJ1ZSk7XG5cbiAgZnVuY3Rpb24gaGl0IChjZWxsSW5kZXgpIHtcbiAgICByZXRzLmNlbGxzW2NlbGxJbmRleF0gPSBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzU3VuaygpIHtcbiAgICByZXR1cm4gcmV0cy5jZWxscy5ldmVyeShjZWxsID0+IChjZWxsID09IGZhbHNlKSk7XG4gIH1cblxuICBjb25zdCByZXRzID0ge1xuICAgIGxlbmd0aCxcbiAgICBjZWxscyxcbiAgICBwb3MsXG4gICAgb3JpZSxcblxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gIH07XG5cbiAgcmV0dXJuIHJldHM7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTaGlwOyIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vZ2FtZWJvYXJkXCI7XG5cbmNvbnN0IGdhbWVib2FyZFNpemUgPSAxMFxuXG5jb25zdCBQbGF5ZXIgPSAobmFtZSwgaXNBST1mYWxzZSkgPT4ge1xuICBjb25zdCBnYW1lYm9hcmQgPSBHYW1lYm9hcmQoZ2FtZWJvYXJkU2l6ZSk7XG5cbiAgZnVuY3Rpb24gYXR0YWNrUmFuZG9tQ2VsbChvcHBvbmVudCkge1xuICAgIGNvbnN0IGxlbmd0aCA9IG9wcG9uZW50LmdhbWVib2FyZC5ib2FyZC5sZW5ndGg7XG5cbiAgICBsZXQgYXR0YWNrU3VjY2VzcyA9IGZhbHNlO1xuICAgIHdoaWxlKCFhdHRhY2tTdWNjZXNzKSB7XG4gICAgICBjb25zdCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbGVuZ3RoKTtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBsZW5ndGgpO1xuXG4gICAgICBjb25zdCBwb3MgPSB7eCwgeX07XG4gICAgICBhdHRhY2tTdWNjZXNzID0gYXR0YWNrT3Bwb25lbnQob3Bwb25lbnQsIHBvcyk7XG4gICAgfVxuICB9XG5cbiAgLy8gUmV0dXJucyB0cnVlIGlmIHRhcmdldCBwb3NpdGlvbiBpcyBhIHZhbGlkIGNsZWxsXG4gIC8vIFJldHVybnMgZmFsc2Ugb3RoZXJ3aXNlXG4gIGZ1bmN0aW9uIGF0dGFja09wcG9uZW50KG9wcG9uZW50LCBwb3MpIHtcbiAgICBpZighb3Bwb25lbnQuZ2FtZWJvYXJkLndhc0NlbGxDaGVja2VkKHBvcykpIHtcbiAgICAgIG9wcG9uZW50LmdhbWVib2FyZC5yZWNpZXZlQXR0YWNrKHBvcyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgcmV0cyA9IHtcbiAgICBuYW1lLFxuICAgIGlzQUksXG4gICAgZ2FtZWJvYXJkLFxuICAgIGF0dGFja09wcG9uZW50XG4gIH07XG5cbiAgaWYgKGlzQUkpIHtcbiAgICByZXRzLmF0dGFja1JhbmRvbUNlbGwgPSBhdHRhY2tSYW5kb21DZWxsO1xuICB9XG5cbiAgcmV0dXJuIHJldHM7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXI7IiwiaW1wb3J0IGRpc3BsYXkgZnJvbSBcIi4vZGlzcGxheUNvbnRyb2xsZXJcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vZ2FtZU9iamVjdHMvcGxheWVyXCI7XG5pbXBvcnQgeyBkaXNhYmxlQm9hcmRzIH0gZnJvbSBcIi4vZGlzcGxheUNvbnRyb2xsZXJcIjtcblxubGV0IHBsYXllcnMgPSB1bmRlZmluZWQ7XG5cbmZ1bmN0aW9uIHN0YXJ0KCkge1xuICBjb25zdCBwbGF5ZXIgPSBQbGF5ZXIoJ1BsYXllcicpO1xuICBjb25zdCBjb21wdXRlckFJID0gUGxheWVyKCdDUFUnLCB0cnVlKTtcblxuICBwbGF5ZXJzID0gW3BsYXllciwgY29tcHV0ZXJBSV07XG4gIGNvbXB1dGVyU2V0dXAoKTtcbiAgcGxheWVyU2V0dXAoKTtcbn1cblxuZnVuY3Rpb24gcGxheWVyU2V0dXAoKSB7XG4gIGNvbnN0IHBsYXllciA9IHBsYXllcnNbMF07XG5cbiAgZGlzcGxheS5yZW5kZXJQbGF5ZXJCb2FyZChwbGF5ZXIpO1xufVxuXG5mdW5jdGlvbiBjb21wdXRlclNldHVwKCkge1xuICBjb25zdCBvcHBvbmVudCA9IHBsYXllcnNbMV07XG5cbiAgb3Bwb25lbnQuZ2FtZWJvYXJkLnNjcmFtYmxlU2hpcHMoKVxuICBkaXNwbGF5LnJlbmRlck9wcG9uZW50Qm9hcmQob3Bwb25lbnQpO1xufVxuXG5cbmZ1bmN0aW9uIGdhbWUoKSB7XG4gIGNvbnN0IG9wcG9uZW50ID0gcGxheWVyc1sxXTtcbiAgZGlzcGxheS5yZW5kZXJPcHBvbmVudEJvYXJkKG9wcG9uZW50KTtcbn1cblxuZnVuY3Rpb24gZ2FtZVBsYXllclR1cm4oZXZ0KSB7XG4gIGNvbnN0IHBsYXllciA9IHBsYXllcnNbMF07XG4gIGNvbnN0IG9wcG9uZW50ID0gcGxheWVyc1sxXTtcblxuICBjb25zdCBnYW1lYm9hcmQgPSBwbGF5ZXIuZ2FtZWJvYXJkO1xuICBjb25zdCBzaXplID0gZ2FtZWJvYXJkLnNpZGVMZW5ndGg7XG5cbiAgY29uc3QgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcbiAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2JvYXJkLWNlbGwnKSkge1xuICAgIGNvbnN0IGdyaWRDZWxscyA9IHRhcmdldC5wYXJlbnROb2RlLmNoaWxkcmVuO1xuICAgIGNvbnN0IHRhcmdldEluZGV4ID0gIEFycmF5LmZyb20oZ3JpZENlbGxzKS5pbmRleE9mKHRhcmdldCk7XG5cbiAgICBjb25zdCB0YXJnZXRSb3cgPSBNYXRoLmZsb29yKHRhcmdldEluZGV4IC8gc2l6ZSk7XG4gICAgY29uc3QgdGFyZ2V0Q29sID0gdGFyZ2V0SW5kZXggJSBzaXplO1xuXG4gICAgbGV0IGxlZ2FsTW92ZSA9IGZhbHNlO1xuICAgIGxlZ2FsTW92ZSA9IHBsYXllci5hdHRhY2tPcHBvbmVudChvcHBvbmVudCwge3g6dGFyZ2V0Q29sLCB5OnRhcmdldFJvd30pO1xuICAgIGlmICghbGVnYWxNb3ZlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZGlzcGxheS5yZW5kZXJPcHBvbmVudEJvYXJkKG9wcG9uZW50KTtcbiAgICBnYW1lT3Bwb25lbnRUdXJuKCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2FtZU9wcG9uZW50VHVybigpIHtcbiAgY29uc3QgcGxheWVyID0gcGxheWVyc1swXTtcbiAgY29uc3Qgb3Bwb25lbnQgPSBwbGF5ZXJzWzFdO1xuXG4gIC8vIEN1cnJlbnRseSBsb29waW5nIHRvIGluZmluaXR5XG4gIG9wcG9uZW50LmF0dGFja1JhbmRvbUNlbGwocGxheWVyKTtcbiAgZGlzcGxheS5yZW5kZXJQbGF5ZXJCb2FyZChwbGF5ZXIpO1xufVxuXG5mdW5jdGlvbiBkZXRlcm1pbmVXaW5uZXIoKSB7XG4gIGNvbnN0IHBsYXllciA9IHBsYXllcnNbMF07XG4gIGNvbnN0IG9wcG9uZW50ID0gcGxheWVyc1sxXTtcblxuICBjb25zdCBwbGF5ZXJHYW1lYm9hcmQgPSBwbGF5ZXIuZ2FtZWJvYXJkO1xuXG4gIGlmIChwbGF5ZXJHYW1lYm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkpIHtcbiAgICBkZWNsYXJlV2lubmVyKG9wcG9uZW50KTtcbiAgfSBlbHNlIHtcbiAgICBkZWNsYXJlV2lubmVyKHBsYXllcik7XG4gIH1cblxuICBkaXNhYmxlQm9hcmRzKHBsYXllcnMpO1xufVxuXG5mdW5jdGlvbiBkZWNsYXJlV2lubmVyKHBsYXllcikge1xuICBjb25zb2xlLmxvZyhgJHtwbGF5ZXIubmFtZX0gd2lucyFgKTtcbn1cblxuc3RhcnQoKTtcblxuZXhwb3J0IHsgZ2FtZSwgZ2FtZVBsYXllclR1cm4sIGRldGVybWluZVdpbm5lciB9OyJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImluR2FtZWxvb3AiLCJzZWxlY3RlZFJvdGF0aW9uIiwiZGlzcGxheUNvbnRyb2xsZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJkaXNwbGF5R2FtZWJvYXJkcyIsInBsYXllckRpc3BsYXlHYW1lYm9hcmQiLCJvcHBvbmVudERpc3BsYXlHYW1lYm9hcmQiLCJjbGVhckRpc3BsYXlCb2FyZCIsImRpc3BsYXlHYW1lYm9hcmQiLCJ0ZXh0Q29udGVudCIsInJlbmRlclBsYXllckJvYXJkIiwicGxheWVyIiwiZ2FtZWJvYXJkIiwiZGlzcGxheUdyaWQiLCJlbGVtZW50QnVpbGRlciIsImJ1aWxkUGxheWVyQm9hcmQiLCJhcmVBbGxTaGlwc1BsYWNlZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJzaXplIiwic2lkZUxlbmd0aCIsInRhcmdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiZ3JpZENlbGxzIiwicGFyZW50Tm9kZSIsImNoaWxkcmVuIiwidGFyZ2V0SW5kZXgiLCJBcnJheSIsImZyb20iLCJpbmRleE9mIiwidGFyZ2V0Um93IiwiTWF0aCIsImZsb29yIiwidGFyZ2V0Q29sIiwic2V0U2hpcCIsIngiLCJ5IiwiZ2FtZSIsImFkZFNoaXAiLCJhcHBlbmRDaGlsZCIsInJlbmRlck9wcG9uZW50Qm9hcmQiLCJvcHBvbmVudCIsImJ1aWxkT3Bwb25lbnRCb2FyZCIsImdhbWVQbGF5ZXJUdXJuIiwiYm9hcmRHcmlkIiwiY3JlYXRlRWxlbWVudCIsImFkZCIsInJvdyIsImJvYXJkIiwiY2VsbCIsImJvYXJkQ2VsbCIsImhhc1NoaXAiLCJpc0NoZWNrZWQiLCJnZXRFbGVtZW50QnlJZCIsIkNlbGwiLCJyZXRzIiwic2hpcCIsInNoaXBJbmRleCIsImFzc2lnblNoaXAiLCJpbmRleCIsImdyaWQiLCJyIiwiYyIsIl9jcmVhdGVCb2FyZEdyaWQiLCJuZXh0U2hpcExlbmd0aHMiLCJhcmVBbGxTaGlwc1N1bmsiLCJzaGlwcyIsIm1hcCIsImlzU3VuayIsImV2ZXJ5IiwiYm9vbFZhbHVlIiwiZ2V0Q2VsbCIsInBvcyIsIm1pc3NlZCIsIm9yaWUiLCJsZW5ndGgiLCJjZWxscyIsImZpbGwiLCJoaXQiLCJjZWxsSW5kZXgiLCJyZXN1bHQiLCJzdGFydFBvcyIsInRvT2NjdXB5Q2VsbHMiLCJpIiwicHVzaCIsInVuZGVmaW5lZCIsImZvckVhY2giLCJfYXNzaWduU2hpcENlbGxzIiwic2hpZnQiLCJzY3JhbWJsZVNoaXBzIiwicmFuZE9yaWUiLCJyYW5kb20iLCJyYW5kWCIsInJhbmRZIiwicmVjaWV2ZUF0dGFjayIsImNvbnNvbGUiLCJsb2ciLCJkZXRlcm1pbmVXaW5uZXIiLCJ3YXNDZWxsQ2hlY2tlZCIsIm5hbWUiLCJpc0FJIiwiYXR0YWNrT3Bwb25lbnQiLCJhdHRhY2tSYW5kb21DZWxsIiwiYXR0YWNrU3VjY2VzcyIsInBsYXllcnMiLCJsZWdhbE1vdmUiLCJnYW1lT3Bwb25lbnRUdXJuIiwiZGVjbGFyZVdpbm5lciIsImRpc2FibGVCb2FyZHMiLCJjb21wdXRlckFJIiwiY29tcHV0ZXJTZXR1cCIsInBsYXllclNldHVwIiwic3RhcnQiXSwic291cmNlUm9vdCI6IiJ9