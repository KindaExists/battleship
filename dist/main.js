(()=>{"use strict";const e=function(e){const n=document.createElement("div");n.classList.add("board-grid");for(let t of e.board)for(let e of t){const t=document.createElement("div");t.classList.add("board-cell"),e.hasShip()&&e.isChecked?t.classList.add("dead-ship-cell"):e.hasShip()?t.classList.add("live-ship-cell"):e.isChecked&&t.classList.add("cell-checked"),n.appendChild(t)}return n},n=(()=>{const n=document.querySelector("#player .gameboard"),t=document.querySelector("#opponent .gameboard");function r(e){e.textContent=""}return{renderPlayerGameboard:function(t){r(n);const a=e(t);n.appendChild(a)},renderOpponentGameboard:function(n){r(t);const a=e(n);t.appendChild(a)}}})(),t=(()=>{const e=document.querySelector("#player .gameboard"),n=document.querySelector("#opponent .gameboard");function t(e){const n=e,t=n.cloneNode(!0);n.parentNode.replaceChild(t,n)}function r(e,n,t,r){const a=e.target;if(a.classList.contains("board-cell")){const e=n.gameboard.sideLength,o=a.parentNode.children,s=Array.from(o).indexOf(a);let i=[];for(let n=0;n<t;n++){const t=s+n;if(i.push(o[t]),t%e+1>=e)break}i.forEach((e=>{r?e.classList.add("highlighted"):e.classList.remove("highlighted")}))}}function a(e,n){const t=e.target;t.classList.contains("board-cell")&&(n?t.classList.add("highlighted"):t.classList.remove("highlighted"))}const o={attachAddShipEvents:function(n,t,a){e.addEventListener("mouseenter",(e=>r(e,n,a,!0)),!0),e.addEventListener("mouseleave",(e=>r(e,n,a,!1)),!0)},attachAttackEvents:function(e,t){n.addEventListener("mouseenter",(e=>a(e,!0)),!0),n.addEventListener("mouseleave",(e=>a(e,!1)),!0),n.addEventListener("click",(n=>function(e,n,t){const r=e.target;if(r.classList.contains("board-cell")){const e=function(e,n){const t=n.sideLength,r=e.parentNode.children,a=Array.from(r).indexOf(e);return{x:a%t,y:Math.floor(a/t)}}(r,t.gameboard);n.attackOpponent(t,e)&&(i.completeGameTurn(n,t),function(e,n){e.isWinner?i.declareWinner(e):n.isWinner&&i.declareWinner(n)}(n,t))}}(n,e,t)),!0)},clearGridEvents:function(){t(e),t(n)}};return o})(),r=t,a=()=>{const e={isChecked:!1,ship:null,shipIndex:null,assignShip(n,t){e.ship=n,e.shipIndex=t},hasShip:()=>null!==e.ship};return e},o=e=>{const n=e,t=function(e){let n=Array(e);for(let t=0;t<e;t++){n[t]=Array(e);for(let r=0;r<e;r++)n[t][r]=a()}return n}(e);function r(){return s.ships.map((e=>e.isSunk())).every((e=>!0===e))}function o(e){return s.board[e.y][e.x]}const s={sideLength:n,board:t,ships:[],missed:[],getCell:o,setShip:function(e,t,r){const a=((e,n,t)=>{const r={length:e,cells:Array(e).fill(!0),pos:n,orie:t,hit:function(e){r.cells[e]=!1},isSunk:function(){return r.cells.every((e=>0==e))}};return r})(e,t,r),i=function(e){const t=e.length,r=e.pos,a=e.orie;let s=[];for(let e=0;e<t;e++){let t;"horizontal"===a?r.x+e<n&&(t=o({x:r.x+e,y:r.y})):"vertical"===a&&r.y+e<n&&(t=o({x:r.x,y:r.y+e})),s.push([t,e])}return!!s.every((e=>void 0!==e[0]&&!e[0].hasShip()))&&(s.forEach((n=>{n[0].assignShip(e,n[1])})),!0)}(a);return i&&s.ships.push(a),i},areAllShipsSunk:r,scrambleShips:function(e){let t=0;for(;t<e.length;){const r=Math.floor(2*Math.random())?"horizontal":"vertical",a=Math.floor(Math.random()*n),o=Math.floor(Math.random()*n);s.setShip(e[t],{x:a,y:o},r)&&t++}},recieveAttack:function(e){const n=o({x:e.x,y:e.y});if(n.hasShip()){const e=n.ship,t=n.shipIndex;e.hit(t),e.isSunk()&&console.log("Ship Sunk")}else s.missed.push(e);return n.isChecked=!0,r()},wasCellChecked:function(e){return!0===o(e).isChecked}};return s},s=(e,n=!1)=>{function t(e,n){return!e.gameboard.wasCellChecked(n)&&(e.gameboard.recieveAttack(n)&&(r.isWinner=!0),!0)}const r={name:e,isAI:n,gameboard:o(10),attackOpponent:t,isWinner:!1};return n&&(r.attackRandomCell=function(e){const n=e.gameboard.board.length;let r=!1;for(;!r;)r=t(e,{x:Math.floor(Math.random()*n),y:Math.floor(Math.random()*n)})}),r},i=(()=>{function e(e,n){r.attachAddShipEvents(e,n,5)}return{setupGame:function(){const t=s("User"),r=s("Computer",!0);n.renderPlayerGameboard(t.gameboard),n.renderOpponentGameboard(r.gameboard),e(t,r)},beginShipSetupPhase:e,beginAttackPhase:function(e,n){r.attachAttackEvents(e,n)},completeGameTurn:function(e,t){t.attackRandomCell(e),n.renderOpponentGameboard(t.gameboard),n.renderPlayerGameboard(e.gameboard)},declareWinner:function(e){r.clearGridEvents(),console.log(`${e.name} wins!`)}}})();i.setupGame()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cC8uL3NyYy9lbGVtZW50QnVpbGRlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlDb250cm9sbGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUV2ZW50cy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVPYmplY3RzL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVPYmplY3RzL3NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lT2JqZWN0cy9wbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGVsZW1lbnRCdWlsZGVyID0gKCgpID0+IHtcbiAgZnVuY3Rpb24gYnVpbGRQbGF5ZXJHcmlkKGdhbWVib2FyZCkge1xuICAgIGNvbnN0IGJvYXJkR3JpZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGJvYXJkR3JpZC5jbGFzc0xpc3QuYWRkKCdib2FyZC1ncmlkJyk7XG5cbiAgICBmb3IgKGxldCByb3cgb2YgZ2FtZWJvYXJkLmJvYXJkKSB7XG4gICAgICBmb3IgKGxldCBjZWxsIG9mIHJvdykge1xuICAgICAgICBjb25zdCBib2FyZENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgYm9hcmRDZWxsLmNsYXNzTGlzdC5hZGQoJ2JvYXJkLWNlbGwnKTtcblxuICAgICAgICBpZiAoY2VsbC5oYXNTaGlwKCkgJiYgY2VsbC5pc0NoZWNrZWQpIHtcbiAgICAgICAgICBib2FyZENlbGwuY2xhc3NMaXN0LmFkZCgnZGVhZC1zaGlwLWNlbGwnKTtcbiAgICAgICAgfSBlbHNlIGlmIChjZWxsLmhhc1NoaXAoKSkge1xuICAgICAgICAgIGJvYXJkQ2VsbC5jbGFzc0xpc3QuYWRkKCdsaXZlLXNoaXAtY2VsbCcpO1xuICAgICAgICB9IGVsc2UgaWYgKGNlbGwuaXNDaGVja2VkKSB7XG4gICAgICAgICAgYm9hcmRDZWxsLmNsYXNzTGlzdC5hZGQoJ2NlbGwtY2hlY2tlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgYm9hcmRHcmlkLmFwcGVuZENoaWxkKGJvYXJkQ2VsbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkR3JpZDtcbiAgfVxuXG4gIGNvbnN0IHJldHMgPSB7XG4gICAgYnVpbGRQbGF5ZXJHcmlkLFxuICB9O1xuXG4gIHJldHVybiByZXRzO1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgZWxlbWVudEJ1aWxkZXI7IiwiaW1wb3J0IGVsZW1lbnRCdWlsZGVyIGZyb20gXCIuL2VsZW1lbnRCdWlsZGVyXCI7XG5cbmNvbnN0IGRpc3BsYXlDb250cm9sbGVyID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVyRGlzcGxheUdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGxheWVyIC5nYW1lYm9hcmQnKTtcbiAgY29uc3Qgb3Bwb25lbnREaXNwbGF5R3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNvcHBvbmVudCAuZ2FtZWJvYXJkJyk7XG5cbiAgZnVuY3Rpb24gX2NsZWFyRGlzcGxheUdyaWQoZ3JpZCkge1xuICAgIGdyaWQudGV4dENvbnRlbnQgPSAnJztcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlclBsYXllckdhbWVib2FyZChnYW1lYm9hcmQpIHtcbiAgICBfY2xlYXJEaXNwbGF5R3JpZChwbGF5ZXJEaXNwbGF5R3JpZCk7XG4gICAgY29uc3QgZGlzcGxheUdyaWQgPSBlbGVtZW50QnVpbGRlci5idWlsZFBsYXllckdyaWQoZ2FtZWJvYXJkKTtcbiAgICBwbGF5ZXJEaXNwbGF5R3JpZC5hcHBlbmRDaGlsZChkaXNwbGF5R3JpZCk7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJPcHBvbmVudEdhbWVib2FyZChnYW1lYm9hcmQpIHtcbiAgICBfY2xlYXJEaXNwbGF5R3JpZChvcHBvbmVudERpc3BsYXlHcmlkKTtcbiAgICBjb25zdCBkaXNwbGF5R3JpZCA9IGVsZW1lbnRCdWlsZGVyLmJ1aWxkUGxheWVyR3JpZChnYW1lYm9hcmQpO1xuICAgIG9wcG9uZW50RGlzcGxheUdyaWQuYXBwZW5kQ2hpbGQoZGlzcGxheUdyaWQpO1xuICB9XG5cbiAgY29uc3QgcmV0cyA9IHtcbiAgICByZW5kZXJQbGF5ZXJHYW1lYm9hcmQsXG4gICAgcmVuZGVyT3Bwb25lbnRHYW1lYm9hcmQsXG4gIH07XG5cbiAgcmV0dXJuIHJldHM7XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBkaXNwbGF5Q29udHJvbGxlcjsiLCJpbXBvcnQgZGlzcGxheUNvbnRyb2xsZXIgZnJvbSBcIi4vZGlzcGxheUNvbnRyb2xsZXJcIjtcbmltcG9ydCBnYW1lQ29udHJvbGxlciBmcm9tIFwiLi9nYW1lQ29udHJvbGxlclwiO1xuXG5jb25zdCBnYW1lRXZlbnRzID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVyRGlzcGxheUdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGxheWVyIC5nYW1lYm9hcmQnKTtcbiAgY29uc3Qgb3Bwb25lbnREaXNwbGF5R3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNvcHBvbmVudCAuZ2FtZWJvYXJkJyk7XG5cbiAgZnVuY3Rpb24gYXR0YWNoQWRkU2hpcEV2ZW50cyhodW1hblBsYXllciwgb3Bwb25lbnRQbGF5ZXIsIHNoaXBMZW5ndGgpIHtcbiAgICBwbGF5ZXJEaXNwbGF5R3JpZC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKGUpID0+IF9zZXRTaGlwSGlnaGxpZ2h0KGUsIGh1bWFuUGxheWVyLCBzaGlwTGVuZ3RoLCB0cnVlKSwgdHJ1ZSk7O1xuICAgIHBsYXllckRpc3BsYXlHcmlkLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoZSkgPT4gX3NldFNoaXBIaWdobGlnaHQoZSwgaHVtYW5QbGF5ZXIsIHNoaXBMZW5ndGgsIGZhbHNlKSwgdHJ1ZSk7O1xuICB9XG5cbiAgZnVuY3Rpb24gYXR0YWNoQXR0YWNrRXZlbnRzKGh1bWFuUGxheWVyLCBvcHBvbmVudFBsYXllcikge1xuICAgIG9wcG9uZW50RGlzcGxheUdyaWQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChlKSA9PiBfc2V0QXR0YWNrSGlnaGxpZ2h0KGUsIHRydWUpLCB0cnVlKTs7XG4gICAgb3Bwb25lbnREaXNwbGF5R3JpZC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKGUpID0+IF9zZXRBdHRhY2tIaWdobGlnaHQoZSwgZmFsc2UpLCB0cnVlKTtcbiAgICBvcHBvbmVudERpc3BsYXlHcmlkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IF9hdHRhY2tPcHBvbmVudENlbGxPbkdyaWQoZSwgaHVtYW5QbGF5ZXIsIG9wcG9uZW50UGxheWVyKSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhckdyaWRFdmVudHMoKSB7XG4gICAgY2xlYXJBbGxFbGVtZW50RXZlbnRzKHBsYXllckRpc3BsYXlHcmlkKTtcbiAgICBjbGVhckFsbEVsZW1lbnRFdmVudHMob3Bwb25lbnREaXNwbGF5R3JpZCk7XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhckFsbEVsZW1lbnRFdmVudHMoZWxlbWVudCkge1xuICAgIGNvbnN0IG9sZEVsZW1lbnQgPSBlbGVtZW50O1xuICAgIGNvbnN0IGNsZWFyZWRFbGVtZW50ID0gb2xkRWxlbWVudC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgb2xkRWxlbWVudC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChjbGVhcmVkRWxlbWVudCwgb2xkRWxlbWVudCk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIF9zZXRTaGlwSGlnaGxpZ2h0KGUsIHBsYXllciwgbGVuZ3RoLCBoaWdobGlnaHRlZCkge1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdib2FyZC1jZWxsJykpIHtcbiAgICAgIGNvbnN0IHBsYXllckdhbWVib2FyZCA9IHBsYXllci5nYW1lYm9hcmQ7XG5cbiAgICAgIGNvbnN0IHNpemUgPSBwbGF5ZXJHYW1lYm9hcmQuc2lkZUxlbmd0aDtcbiAgICAgIGNvbnN0IGdyaWRDZWxsTGlzdCA9IHRhcmdldC5wYXJlbnROb2RlLmNoaWxkcmVuO1xuICAgICAgY29uc3QgdGFyZ2V0SW5kZXggPSAgQXJyYXkuZnJvbShncmlkQ2VsbExpc3QpLmluZGV4T2YodGFyZ2V0KTtcblxuICAgICAgbGV0IHRvSGlnaGxpZ2h0Q2VsbHMgPSBbXTtcbiAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBncmlkQ2VsbEluZGV4ID0gdGFyZ2V0SW5kZXggKyBpO1xuICAgICAgICB0b0hpZ2hsaWdodENlbGxzLnB1c2goZ3JpZENlbGxMaXN0W2dyaWRDZWxsSW5kZXhdKTtcbiAgICAgICAgaWYgKChncmlkQ2VsbEluZGV4ICUgc2l6ZSkgKyAxID49IHNpemUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAvKlxuICAgICAgICBjb25zdCBncmlkQ2VsbEluZGV4ID0gdGFyZ2V0SW5kZXggKyAoaSAqIHNpemUpO1xuICAgICAgICB0b0hpZ2hsaWdodENlbGxzLnB1c2goZ3JpZENlbGxMaXN0W2dyaWRDZWxsSW5kZXhdKTtcbiAgICAgICAgaWYgKE1hdGguZmxvb3IoZ3JpZENlbGxJbmRleCAvIHNpemUpICsgMSA+PSBzaXplKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgKi9cbiAgICAgIH1cblxuICAgICAgdG9IaWdobGlnaHRDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgIGlmKGhpZ2hsaWdodGVkKSB7XG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHRlZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2F0dGFja09wcG9uZW50Q2VsbE9uR3JpZChlLCBwbGF5ZXIsIG9wcG9uZW50KSB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG5cbiAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnYm9hcmQtY2VsbCcpKSB7XG4gICAgICBjb25zdCB0YXJnZXRQb3MgPSBfZ2V0VGFyZ2V0UG9zKHRhcmdldCwgb3Bwb25lbnQuZ2FtZWJvYXJkKTtcblxuICAgICAgY29uc3QgaXNMZWdhbE1vdmUgPSBwbGF5ZXIuYXR0YWNrT3Bwb25lbnQob3Bwb25lbnQsIHRhcmdldFBvcyk7XG4gICAgICBpZiAoaXNMZWdhbE1vdmUpIHtcbiAgICAgICAgZ2FtZUNvbnRyb2xsZXIuY29tcGxldGVHYW1lVHVybihwbGF5ZXIsIG9wcG9uZW50KTtcbiAgICAgICAgX2NoZWNrRm9yV2lubmVyKHBsYXllciwgb3Bwb25lbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRUYXJnZXRQb3ModGFyZ2V0LCBnYW1lYm9hcmQpIHtcbiAgICBjb25zdCBzaXplID0gZ2FtZWJvYXJkLnNpZGVMZW5ndGg7XG4gICAgY29uc3QgZ3JpZENlbGxMaXN0ID0gdGFyZ2V0LnBhcmVudE5vZGUuY2hpbGRyZW47XG4gICAgY29uc3QgdGFyZ2V0SW5kZXggPSAgQXJyYXkuZnJvbShncmlkQ2VsbExpc3QpLmluZGV4T2YodGFyZ2V0KTtcblxuICAgIGNvbnN0IHRhcmdldFggPSB0YXJnZXRJbmRleCAlIHNpemU7XG4gICAgY29uc3QgdGFyZ2V0WSA9IE1hdGguZmxvb3IodGFyZ2V0SW5kZXggLyBzaXplKTtcblxuICAgIHJldHVybiB7eDp0YXJnZXRYLCB5OnRhcmdldFl9O1xuICB9XG5cbiAgZnVuY3Rpb24gX2NoZWNrRm9yV2lubmVyKHBsYXllciwgb3Bwb25lbnQpIHtcbiAgICBpZiAocGxheWVyLmlzV2lubmVyKSB7XG4gICAgICBnYW1lQ29udHJvbGxlci5kZWNsYXJlV2lubmVyKHBsYXllcik7XG4gICAgfSBlbHNlIGlmIChvcHBvbmVudC5pc1dpbm5lcikge1xuICAgICAgZ2FtZUNvbnRyb2xsZXIuZGVjbGFyZVdpbm5lcihvcHBvbmVudCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX3NldEF0dGFja0hpZ2hsaWdodChlLCBoaWdobGlnaHRlZCkge1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdib2FyZC1jZWxsJykpIHtcbiAgICAgIGlmIChoaWdobGlnaHRlZCkge1xuICAgICAgICB0YXJnZXQuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0ZWQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHRlZCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG5cbiAgY29uc3QgcmV0cyA9IHtcbiAgICBhdHRhY2hBZGRTaGlwRXZlbnRzLFxuICAgIGF0dGFjaEF0dGFja0V2ZW50cyxcbiAgICBjbGVhckdyaWRFdmVudHMsXG4gIH07XG5cbiAgcmV0dXJuIHJldHM7XG59KSgpO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGdhbWVFdmVudHM7IiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vc2hpcC5qc1wiO1xuLy8gaW1wb3J0IHsgZGV0ZXJtaW5lV2lubmVyIH0gZnJvbSBcIi4uL2luZGV4LmpzXCI7XG5cbmNvbnN0IENlbGwgPSAoKSA9PiB7XG4gIGNvbnN0IHJldHMgPSB7XG4gICAgaXNDaGVja2VkOiBmYWxzZSxcblxuICAgIHNoaXA6IG51bGwsXG4gICAgc2hpcEluZGV4OiBudWxsLFxuICAgIGFzc2lnblNoaXAoc2hpcCwgaW5kZXgpIHtcbiAgICAgIHJldHMuc2hpcCA9IHNoaXA7XG4gICAgICByZXRzLnNoaXBJbmRleCA9IGluZGV4O1xuICAgIH0sXG4gICAgaGFzU2hpcCgpIHtcbiAgICAgIHJldHVybiByZXRzLnNoaXAgIT09IG51bGw7XG4gICAgfSxcbiAgfTtcblxuICByZXR1cm4gcmV0cztcbn07XG5cbmNvbnN0IEdhbWVib2FyZCA9IChzaXplKSA9PiB7XG4gIGNvbnN0IHNpZGVMZW5ndGggPSBzaXplO1xuICBjb25zdCBib2FyZCA9IF9jcmVhdGVCb2FyZEdyaWQoc2l6ZSk7XG4gIGNvbnN0IHNoaXBzID0gW107XG4gIGNvbnN0IG1pc3NlZCA9IFtdO1xuXG4gIGZ1bmN0aW9uIF9jcmVhdGVCb2FyZEdyaWQoc2l6ZSkge1xuICAgIGxldCBncmlkID0gQXJyYXkoc2l6ZSk7XG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCBzaXplOyByKyspIHtcbiAgICAgIGdyaWRbcl0gPSBBcnJheShzaXplKTtcbiAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgc2l6ZTsgYysrKSB7XG4gICAgICAgIGdyaWRbcl1bY10gPSBDZWxsKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGdyaWQ7XG4gIH1cblxuICBmdW5jdGlvbiBfYXNzaWduU2hpcENlbGxzKHNoaXApIHtcbiAgICBjb25zdCBsZW5ndGggPSBzaGlwLmxlbmd0aDtcbiAgICBjb25zdCBzdGFydFBvcyA9IHNoaXAucG9zO1xuICAgIGNvbnN0IG9yaWUgPSBzaGlwLm9yaWU7XG5cbiAgICBsZXQgdG9PY2N1cHlDZWxscyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGNlbGwgPSB1bmRlZmluZWQ7XG4gICAgICBpZiAob3JpZSA9PT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICAgICAgaWYgKHN0YXJ0UG9zLnggKyBpIDwgc2lkZUxlbmd0aCkge1xuICAgICAgICAgIGNlbGwgPSBnZXRDZWxsKHtcbiAgICAgICAgICAgIHg6IHN0YXJ0UG9zLnggKyBpLFxuICAgICAgICAgICAgeTogc3RhcnRQb3MueSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChvcmllID09PSBcInZlcnRpY2FsXCIpIHtcbiAgICAgICAgaWYgKHN0YXJ0UG9zLnkgKyBpIDwgc2lkZUxlbmd0aCkge1xuICAgICAgICAgIGNlbGwgPSBnZXRDZWxsKHtcbiAgICAgICAgICAgIHg6IHN0YXJ0UG9zLngsXG4gICAgICAgICAgICB5OiBzdGFydFBvcy55ICsgaSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdG9PY2N1cHlDZWxscy5wdXNoKFtjZWxsLCBpXSk7XG4gICAgfVxuXG4gICAgY29uc3QgYXJlTGVnYWxQbGFjZW1lbnRzID0gdG9PY2N1cHlDZWxscy5ldmVyeSgoY2VsbCkgPT4ge1xuICAgICAgaWYgKGNlbGxbMF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoY2VsbFswXS5oYXNTaGlwKCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG5cbiAgICBpZiAoYXJlTGVnYWxQbGFjZW1lbnRzKSB7XG4gICAgICB0b09jY3VweUNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY2VsbFswXS5hc3NpZ25TaGlwKHNoaXAsIGNlbGxbMV0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gYXJlQWxsU2hpcHNTdW5rKCkge1xuICAgIHJldHVybiByZXRzLnNoaXBzXG4gICAgICAubWFwKChzaGlwKSA9PiB7XG4gICAgICAgIHJldHVybiBzaGlwLmlzU3VuaygpO1xuICAgICAgfSlcbiAgICAgIC5ldmVyeSgoYm9vbFZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiBib29sVmFsdWUgPT09IHRydWU7XG4gICAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldENlbGwocG9zKSB7XG4gICAgcmV0dXJuIHJldHMuYm9hcmRbcG9zLnldW3Bvcy54XTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFNoaXAobGVuZ3RoLCBwb3MsIG9yaWUpIHtcbiAgICBjb25zdCBzaGlwID0gU2hpcChsZW5ndGgsIHBvcywgb3JpZSk7XG4gICAgY29uc3QgaXNTdWNjZXNzID0gX2Fzc2lnblNoaXBDZWxscyhzaGlwKTtcbiAgICBpZiAoaXNTdWNjZXNzKSB7XG4gICAgICByZXRzLnNoaXBzLnB1c2goc2hpcCk7XG4gICAgfVxuICAgIHJldHVybiBpc1N1Y2Nlc3M7XG4gIH1cblxuICBmdW5jdGlvbiBzY3JhbWJsZVNoaXBzKHNoaXBMZW5ndGhzKSB7XG4gICAgbGV0IHNoaXBMZW5ndGhzSW5kZXggPSAwXG4gICAgd2hpbGUgKHNoaXBMZW5ndGhzSW5kZXggPCBzaGlwTGVuZ3Rocy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHJhbmRPcmllID0gKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpKSA/ICdob3Jpem9udGFsJyA6ICd2ZXJ0aWNhbCc7XG4gICAgICBjb25zdCByYW5kWCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNpZGVMZW5ndGgpO1xuICAgICAgY29uc3QgcmFuZFkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaWRlTGVuZ3RoKTtcblxuICAgICAgY29uc3QgaXNTdWNjZXNzID0gcmV0cy5zZXRTaGlwKHNoaXBMZW5ndGhzW3NoaXBMZW5ndGhzSW5kZXhdLCB7eDogcmFuZFgsIHk6IHJhbmRZfSwgcmFuZE9yaWUpO1xuICAgICAgaWYoaXNTdWNjZXNzKSB7XG4gICAgICAgIHNoaXBMZW5ndGhzSW5kZXgrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiByZWNpZXZlQXR0YWNrKHBvcykge1xuICAgIGNvbnN0IGNlbGwgPSBnZXRDZWxsKHtcbiAgICAgIHg6IHBvcy54LFxuICAgICAgeTogcG9zLnksXG4gICAgfSk7XG4gICAgaWYgKGNlbGwuaGFzU2hpcCgpKSB7XG4gICAgICBjb25zdCBzaGlwID0gY2VsbC5zaGlwO1xuICAgICAgY29uc3Qgc2hpcEluZGV4ID0gY2VsbC5zaGlwSW5kZXg7XG4gICAgICBzaGlwLmhpdChzaGlwSW5kZXgpO1xuXG4gICAgICBpZiAoc2hpcC5pc1N1bmsoKSkge1xuICAgICAgICAvLyBTaGlwIHN1bmtlbiBjb2RlIGhlcmVcbiAgICAgICAgY29uc29sZS5sb2coXCJTaGlwIFN1bmtcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHMubWlzc2VkLnB1c2gocG9zKTtcbiAgICB9XG4gICAgY2VsbC5pc0NoZWNrZWQgPSB0cnVlO1xuXG4gICAgcmV0dXJuIGFyZUFsbFNoaXBzU3VuaygpXG4gIH1cblxuICBmdW5jdGlvbiB3YXNDZWxsQ2hlY2tlZChwb3MpIHtcbiAgICByZXR1cm4gZ2V0Q2VsbChwb3MpLmlzQ2hlY2tlZCA9PT0gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0IHJldHMgPSB7XG4gICAgc2lkZUxlbmd0aCxcbiAgICBib2FyZCxcbiAgICBzaGlwcyxcbiAgICBtaXNzZWQsXG5cbiAgICBnZXRDZWxsLFxuICAgIHNldFNoaXAsXG4gICAgYXJlQWxsU2hpcHNTdW5rLFxuICAgIHNjcmFtYmxlU2hpcHMsXG4gICAgcmVjaWV2ZUF0dGFjayxcbiAgICB3YXNDZWxsQ2hlY2tlZCxcbiAgfTtcblxuICByZXR1cm4gcmV0cztcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZDtcbiIsImNvbnN0IFNoaXAgPSAobGVuZ3RoLCBwb3MsIG9yaWUpID0+IHtcbiAgY29uc3QgY2VsbHMgPSBBcnJheShsZW5ndGgpLmZpbGwodHJ1ZSk7XG5cbiAgZnVuY3Rpb24gaGl0IChjZWxsSW5kZXgpIHtcbiAgICByZXRzLmNlbGxzW2NlbGxJbmRleF0gPSBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzU3VuaygpIHtcbiAgICByZXR1cm4gcmV0cy5jZWxscy5ldmVyeShjZWxsID0+IChjZWxsID09IGZhbHNlKSk7XG4gIH1cblxuICBjb25zdCByZXRzID0ge1xuICAgIGxlbmd0aCxcbiAgICBjZWxscyxcbiAgICBwb3MsXG4gICAgb3JpZSxcblxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gIH07XG5cbiAgcmV0dXJuIHJldHM7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTaGlwOyIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vZ2FtZWJvYXJkXCI7XG5cbmNvbnN0IGdhbWVib2FyZFNpemUgPSAxMFxuXG5jb25zdCBQbGF5ZXIgPSAobmFtZSwgaXNBST1mYWxzZSkgPT4ge1xuICBsZXQgaXNXaW5uZXIgPSBmYWxzZTtcbiAgY29uc3QgZ2FtZWJvYXJkID0gR2FtZWJvYXJkKGdhbWVib2FyZFNpemUpO1xuXG4gIGZ1bmN0aW9uIGF0dGFja1JhbmRvbUNlbGwob3Bwb25lbnQpIHtcbiAgICBjb25zdCBsZW5ndGggPSBvcHBvbmVudC5nYW1lYm9hcmQuYm9hcmQubGVuZ3RoO1xuXG4gICAgbGV0IGF0dGFja1N1Y2Nlc3MgPSBmYWxzZTtcbiAgICB3aGlsZSghYXR0YWNrU3VjY2Vzcykge1xuICAgICAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGxlbmd0aCk7XG4gICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbGVuZ3RoKTtcblxuICAgICAgY29uc3QgcG9zID0ge3gsIHl9O1xuICAgICAgYXR0YWNrU3VjY2VzcyA9IGF0dGFja09wcG9uZW50KG9wcG9uZW50LCBwb3MpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFJldHVybnMgdHJ1ZSBpZiB0YXJnZXQgcG9zaXRpb24gaXMgYSB2YWxpZCBjZWxsXG4gIC8vIFJldHVybnMgZmFsc2Ugb3RoZXJ3aXNlXG4gIGZ1bmN0aW9uIGF0dGFja09wcG9uZW50KG9wcG9uZW50LCBwb3MpIHtcbiAgICBpZighb3Bwb25lbnQuZ2FtZWJvYXJkLndhc0NlbGxDaGVja2VkKHBvcykpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG9wcG9uZW50LmdhbWVib2FyZC5yZWNpZXZlQXR0YWNrKHBvcyk7XG4gICAgICBpZihyZXN1bHQpIHtcbiAgICAgICAgc2V0V2lubmVyKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFdpbm5lcigpIHtcbiAgICByZXRzLmlzV2lubmVyID0gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0IHJldHMgPSB7XG4gICAgbmFtZSxcbiAgICBpc0FJLFxuICAgIGdhbWVib2FyZCxcbiAgICBhdHRhY2tPcHBvbmVudCxcbiAgICBpc1dpbm5lcixcbiAgfTtcblxuICBpZiAoaXNBSSkge1xuICAgIHJldHMuYXR0YWNrUmFuZG9tQ2VsbCA9IGF0dGFja1JhbmRvbUNlbGw7XG4gIH1cblxuICByZXR1cm4gcmV0cztcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFBsYXllcjsiLCJpbXBvcnQgZGlzcGxheUNvbnRyb2xsZXIgZnJvbSBcIi4vZGlzcGxheUNvbnRyb2xsZXJcIjtcbmltcG9ydCBnYW1lRXZlbnRzIGZyb20gXCIuL2dhbWVFdmVudHNcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vZ2FtZU9iamVjdHMvcGxheWVyXCI7XG5cbmNvbnN0IGdhbWVDb250cm9sbGVyID0gKCgpID0+IHtcbiAgY29uc3Qgc2hpcExlbmd0aHMgPSBbNSwgNCwgMywgMywgMl07XG5cbiAgZnVuY3Rpb24gc2V0dXBHYW1lKCkge1xuICAgIGNvbnN0IGh1bWFuUGxheWVyID0gUGxheWVyKCdVc2VyJyk7XG4gICAgY29uc3QgY29tcHV0ZXJQbGF5ZXIgPSBQbGF5ZXIoJ0NvbXB1dGVyJywgdHJ1ZSk7XG5cbiAgICBkaXNwbGF5Q29udHJvbGxlci5yZW5kZXJQbGF5ZXJHYW1lYm9hcmQoaHVtYW5QbGF5ZXIuZ2FtZWJvYXJkKTtcbiAgICBkaXNwbGF5Q29udHJvbGxlci5yZW5kZXJPcHBvbmVudEdhbWVib2FyZChjb21wdXRlclBsYXllci5nYW1lYm9hcmQpO1xuXG4gICAgYmVnaW5TaGlwU2V0dXBQaGFzZShodW1hblBsYXllciwgY29tcHV0ZXJQbGF5ZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gYmVnaW5TaGlwU2V0dXBQaGFzZShodW1hblBsYXllciwgY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICBnYW1lRXZlbnRzLmF0dGFjaEFkZFNoaXBFdmVudHMoaHVtYW5QbGF5ZXIsIGNvbXB1dGVyUGxheWVyLCA1KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJlZ2luQXR0YWNrUGhhc2UoaHVtYW5QbGF5ZXIsIGNvbXB1dGVyUGxheWVyKSB7XG4gICAgZ2FtZUV2ZW50cy5hdHRhY2hBdHRhY2tFdmVudHMoaHVtYW5QbGF5ZXIsIGNvbXB1dGVyUGxheWVyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvbXBsZXRlR2FtZVR1cm4ocGxheWVyLCBvcHBvbmVudCkge1xuICAgIG9wcG9uZW50LmF0dGFja1JhbmRvbUNlbGwocGxheWVyKTtcbiAgICBkaXNwbGF5Q29udHJvbGxlci5yZW5kZXJPcHBvbmVudEdhbWVib2FyZChvcHBvbmVudC5nYW1lYm9hcmQpO1xuICAgIGRpc3BsYXlDb250cm9sbGVyLnJlbmRlclBsYXllckdhbWVib2FyZChwbGF5ZXIuZ2FtZWJvYXJkKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlY2xhcmVXaW5uZXIod2lubmluZ1BsYXllcikge1xuICAgIGdhbWVFdmVudHMuY2xlYXJHcmlkRXZlbnRzKClcbiAgICBjb25zb2xlLmxvZyhgJHt3aW5uaW5nUGxheWVyLm5hbWV9IHdpbnMhYCk7XG4gIH1cblxuICBjb25zdCByZXRzID0ge1xuICAgIHNldHVwR2FtZSxcbiAgICBiZWdpblNoaXBTZXR1cFBoYXNlLFxuICAgIGJlZ2luQXR0YWNrUGhhc2UsXG4gICAgY29tcGxldGVHYW1lVHVybixcbiAgICBkZWNsYXJlV2lubmVyLFxuICB9O1xuXG4gIHJldHVybiByZXRzO1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgZ2FtZUNvbnRyb2xsZXI7IiwiaW1wb3J0IGdhbWVDb250cm9sbGVyIGZyb20gXCIuL2dhbWVDb250cm9sbGVyXCI7XG5cbmdhbWVDb250cm9sbGVyLnNldHVwR2FtZSgpOyJdLCJuYW1lcyI6WyJnYW1lYm9hcmQiLCJib2FyZEdyaWQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyb3ciLCJib2FyZCIsImNlbGwiLCJib2FyZENlbGwiLCJoYXNTaGlwIiwiaXNDaGVja2VkIiwiYXBwZW5kQ2hpbGQiLCJwbGF5ZXJEaXNwbGF5R3JpZCIsInF1ZXJ5U2VsZWN0b3IiLCJvcHBvbmVudERpc3BsYXlHcmlkIiwiX2NsZWFyRGlzcGxheUdyaWQiLCJncmlkIiwidGV4dENvbnRlbnQiLCJyZW5kZXJQbGF5ZXJHYW1lYm9hcmQiLCJkaXNwbGF5R3JpZCIsInJlbmRlck9wcG9uZW50R2FtZWJvYXJkIiwiZ2FtZUV2ZW50cyIsImNsZWFyQWxsRWxlbWVudEV2ZW50cyIsImVsZW1lbnQiLCJvbGRFbGVtZW50IiwiY2xlYXJlZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJwYXJlbnROb2RlIiwicmVwbGFjZUNoaWxkIiwiX3NldFNoaXBIaWdobGlnaHQiLCJlIiwicGxheWVyIiwibGVuZ3RoIiwiaGlnaGxpZ2h0ZWQiLCJ0YXJnZXQiLCJjb250YWlucyIsInNpemUiLCJzaWRlTGVuZ3RoIiwiZ3JpZENlbGxMaXN0IiwiY2hpbGRyZW4iLCJ0YXJnZXRJbmRleCIsIkFycmF5IiwiZnJvbSIsImluZGV4T2YiLCJ0b0hpZ2hsaWdodENlbGxzIiwiaSIsImdyaWRDZWxsSW5kZXgiLCJwdXNoIiwiZm9yRWFjaCIsInJlbW92ZSIsIl9zZXRBdHRhY2tIaWdobGlnaHQiLCJyZXRzIiwiYXR0YWNoQWRkU2hpcEV2ZW50cyIsImh1bWFuUGxheWVyIiwib3Bwb25lbnRQbGF5ZXIiLCJzaGlwTGVuZ3RoIiwiYWRkRXZlbnRMaXN0ZW5lciIsImF0dGFjaEF0dGFja0V2ZW50cyIsIm9wcG9uZW50IiwidGFyZ2V0UG9zIiwieCIsInkiLCJNYXRoIiwiZmxvb3IiLCJfZ2V0VGFyZ2V0UG9zIiwiYXR0YWNrT3Bwb25lbnQiLCJpc1dpbm5lciIsIl9jaGVja0Zvcldpbm5lciIsIl9hdHRhY2tPcHBvbmVudENlbGxPbkdyaWQiLCJjbGVhckdyaWRFdmVudHMiLCJDZWxsIiwic2hpcCIsInNoaXBJbmRleCIsImFzc2lnblNoaXAiLCJpbmRleCIsInIiLCJjIiwiX2NyZWF0ZUJvYXJkR3JpZCIsImFyZUFsbFNoaXBzU3VuayIsInNoaXBzIiwibWFwIiwiaXNTdW5rIiwiZXZlcnkiLCJib29sVmFsdWUiLCJnZXRDZWxsIiwicG9zIiwibWlzc2VkIiwic2V0U2hpcCIsIm9yaWUiLCJjZWxscyIsImZpbGwiLCJoaXQiLCJjZWxsSW5kZXgiLCJpc1N1Y2Nlc3MiLCJzdGFydFBvcyIsInRvT2NjdXB5Q2VsbHMiLCJ1bmRlZmluZWQiLCJfYXNzaWduU2hpcENlbGxzIiwic2NyYW1ibGVTaGlwcyIsInNoaXBMZW5ndGhzIiwic2hpcExlbmd0aHNJbmRleCIsInJhbmRPcmllIiwicmFuZG9tIiwicmFuZFgiLCJyYW5kWSIsInJlY2lldmVBdHRhY2siLCJjb25zb2xlIiwibG9nIiwid2FzQ2VsbENoZWNrZWQiLCJuYW1lIiwiaXNBSSIsImF0dGFja1JhbmRvbUNlbGwiLCJhdHRhY2tTdWNjZXNzIiwiYmVnaW5TaGlwU2V0dXBQaGFzZSIsImNvbXB1dGVyUGxheWVyIiwic2V0dXBHYW1lIiwiYmVnaW5BdHRhY2tQaGFzZSIsImNvbXBsZXRlR2FtZVR1cm4iLCJkZWNsYXJlV2lubmVyIiwid2lubmluZ1BsYXllciJdLCJzb3VyY2VSb290IjoiIn0=